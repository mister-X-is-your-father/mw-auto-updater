# mw-auto-updater

ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æ™‚ã«å¿…è¦ãªå¤‰æ›´ç‚¹ã‚’è‡ªå‹•ã§æŠ½å‡ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ã€‚

## ä»•çµ„ã¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        config.toml                              â”‚
â”‚  [[middleware]]                                                 â”‚
â”‚  name = "php"                                                   â”‚
â”‚  current = "8.2"                                                â”‚
â”‚  target = "^8.5"                                                â”‚
â”‚  sources = ["github", "local"]  â† è¤‡æ•°ã‚½ãƒ¼ã‚¹æŒ‡å®š                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     mw_upgrade_check.py                         â”‚
â”‚                                                                 â”‚
â”‚  1. config.toml ã‚’èª­ã¿è¾¼ã¿                                       â”‚
â”‚  2. æŒ‡å®šã•ã‚ŒãŸå„ã‚½ãƒ¼ã‚¹ã‹ã‚‰ç‹¬ç«‹ã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—                        â”‚
â”‚  3. ã‚½ãƒ¼ã‚¹ã”ã¨ã«åˆ†é¡ãƒ»é›†è¨ˆã—ã¦å‡ºåŠ›                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    GitHub    â”‚    â”‚  php.watch   â”‚    â”‚    Local     â”‚
    â”‚   UPGRADING  â”‚    â”‚   (HTML)     â”‚    â”‚   *.toml     â”‚
    â”‚  (Markdown)  â”‚    â”‚              â”‚    â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    php/php-src ã®      php.watch/versions   data/ å†…ã®
    å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ      ã‹ã‚‰ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—        æ‰‹å‹•ç®¡ç†ãƒ‡ãƒ¼ã‚¿
```

## ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

| ã‚½ãƒ¼ã‚¹ | URL | ç‰¹å¾´ |
|--------|-----|------|
| `github` | `github.com/php/php-src/UPGRADING` | å…¬å¼ãƒ»æœ€æ–°ãƒ»Markdown |
| `php.watch` | `php.watch/versions/{version}` | è¦‹ã‚„ã™ã„ãŒéå…¬å¼ |
| `local` | `data/php-X.X-changes.toml` | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ |

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
git clone https://github.com/mister-X-is-your-father/mw-auto-updater.git
cd mw-auto-updater

# uv ã§ä»®æƒ³ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
uv sync

# å®Ÿè¡Œ
uv run mw-upgrade-check --output=text
```

ä¾å­˜: Python 3.9+, [uv](https://docs.astral.sh/uv/) (æ¨å¥¨)

## ä½¿ã„æ–¹

### 1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†

```toml
# config.toml
[[middleware]]
name = "php"
current = "8.2"                    # ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
target = "^8.5"                    # ç›®æ¨™ãƒãƒ¼ã‚¸ãƒ§ãƒ³
sources = ["github", "local"]      # ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼ˆè¤‡æ•°æŒ‡å®šå¯ï¼‰
```

### 2. å®Ÿè¡Œ

```bash
# ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§å‡ºåŠ›
uv run mw-upgrade-check --output=text

# JSONå½¢å¼ã§å‡ºåŠ›ï¼ˆAI/ã‚¹ã‚¯ãƒªãƒ—ãƒˆé€£æºç”¨ï¼‰
uv run mw-upgrade-check
```

### 3. å‡ºåŠ›ä¾‹

```
======================================================================
Middleware: PHP
Upgrade: 8.2 â†’ 8.5
Versions: 8.3, 8.4, 8.5
======================================================================

ğŸ“¦ Source: github
   Total: 29 | Breaking: 3 | Deprecations: 13 | Removed: 0 | New: 13

   âš ï¸  BREAKING CHANGES (github):
      [8.3] Calendar easter_date() now supports years...
      [8.4] TypeError for invalid offset types...

   âš¡ DEPRECATIONS (github):
      [8.3] Using the ++ operator on empty strings is deprecated
      [8.5] Binding an instance to a static closure...

ğŸ“¦ Source: local
   Total: 40 | Breaking: 4 | Deprecations: 23 | Removed: 1 | New: 12

   âš ï¸  BREAKING CHANGES (local):
      [8.3] mb_strimwidth() behavior change
      [8.4] exit() and die() are now proper language constructs

   âš¡ DEPRECATIONS (local):
      [8.3] Dynamic properties are deprecated
         â†’ Use declared properties or #[AllowDynamicProperties]
```

## å‡¦ç†ãƒ•ãƒ­ãƒ¼

1. **è¨­å®šèª­è¾¼**: `config.toml` ã‹ã‚‰ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æƒ…å ±ã¨å¯¾è±¡ã‚½ãƒ¼ã‚¹ã‚’å–å¾—
2. **ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±•é–‹**: `8.2 â†’ 8.5` ã‚’ `[8.3, 8.4, 8.5]` ã«å±•é–‹
3. **ã‚½ãƒ¼ã‚¹åˆ¥å–å¾—**: å„ã‚½ãƒ¼ã‚¹ã‹ã‚‰ç‹¬ç«‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
   - `github`: `PHP-{version}` ãƒ–ãƒ©ãƒ³ãƒã® UPGRADING ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒ¼ã‚¹
   - `php.watch`: HTML ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ—ã—ã¦å¤‰æ›´ç‚¹ã‚’æŠ½å‡º
   - `local`: `data/php-{version}-changes.toml` ã‚’èª­ã¿è¾¼ã¿
4. **åˆ†é¡**: å„å¤‰æ›´ã‚’ `breaking` / `deprecation` / `removed` / `new` ã«åˆ†é¡
5. **å‡ºåŠ›**: ã‚½ãƒ¼ã‚¹ã”ã¨ã«çµæœã‚’è¡¨ç¤ºï¼ˆJSON ã¾ãŸã¯ ãƒ†ã‚­ã‚¹ãƒˆï¼‰

## ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†

`data/*.toml` ã¯ AI ãŒç”Ÿæˆã—ã€äººé–“ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ç®¡ç†ã—ã¾ã™ã€‚

```toml
# data/php-8.5-changes.toml
version = "8.5"
from = "8.4"

[[changes]]
type = "deprecation"
category = "syntax"
description = "Backtick operator is deprecated"
description_ja = "ãƒãƒƒã‚¯ã‚¯ã‚©ãƒ¼ãƒˆæ¼”ç®—å­ãŒéæ¨å¥¨"
pattern = '`[^`]+`'
replacement = "Use shell_exec() function instead"
```

## å¯¾å¿œãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

| Name | Status | ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ |
|------|--------|-------------|
| PHP  | âœ… å¯¾å¿œ | github, php.watch, local |
| Laravel | ğŸš§ è¨ˆç”»ä¸­ | - |
| MySQL | ğŸš§ è¨ˆç”»ä¸­ | - |

## Phase 2: å½±éŸ¿åˆ†æãƒ„ãƒ¼ãƒ«

ç ´å£Šçš„å¤‰æ›´ãŒã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’åˆ†æã—ã€Markdownãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚

### ä½¿ã„æ–¹

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å½±éŸ¿åˆ†æï¼ˆAI ãªã—ï¼‰
uv run python analyze_impact.py --codebase /path/to/your/project

# Claude API ã‚’ä½¿ç”¨ã—ã¦è©³ç´°åˆ†æ
uv run python analyze_impact.py --codebase /path/to/project --ai api

# Claude Code ç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãƒ¬ãƒãƒ¼ãƒˆã«å‡ºåŠ›
uv run python analyze_impact.py --codebase /path/to/project --ai claude-code

# å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
uv run python analyze_impact.py --codebase /path/to/project --output my_report.md
```

### AI ãƒ¢ãƒ¼ãƒ‰

| ãƒ¢ãƒ¼ãƒ‰ | èª¬æ˜ |
|--------|------|
| `none` | ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã®ã¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |
| `api` | Claude API ã§å„å¤‰æ›´ã‚’è©³ç´°åˆ†æ |
| `claude-code` | Claude Code ã§æ‰‹å‹•åˆ†æã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å‡ºåŠ› |

### åˆ†æãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     analyze_impact.py                           â”‚
â”‚                                                                 â”‚
â”‚  1. ç ´å£Šçš„å¤‰æ›´ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ï¼ˆPhase 1 å‡ºåŠ› or ãƒ­ãƒ¼ã‚«ãƒ«TOMLï¼‰    â”‚
â”‚  2. å„å¤‰æ›´ã® pattern ã§ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ grep æ¤œç´¢                   â”‚
â”‚  3. è©²å½“ç®‡æ‰€ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå‰å¾Œ5è¡Œï¼‰ã‚’å–å¾—                       â”‚
â”‚  4. AI åˆ†æï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰                                        â”‚
â”‚  5. Markdown ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      impact_report.md                           â”‚
â”‚                                                                 â”‚
â”‚  - ã‚µãƒãƒªãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¤‰æ›´æ•°ã€è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«æ•°ã€ãƒªã‚¹ã‚¯ï¼‰             â”‚
â”‚  - å„å¤‰æ›´ã®è©³ç´°ï¼ˆè©²å½“ç®‡æ‰€ã€ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆï¼‰                     â”‚
â”‚  - AI åˆ†æçµæœï¼ˆapi/claude-code ãƒ¢ãƒ¼ãƒ‰æ™‚ï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‡ºåŠ›ä¾‹

```markdown
# ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å½±éŸ¿åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## ã‚µãƒãƒªãƒ¼
| # | å¤‰æ›´å†…å®¹ | è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«æ•° | ãƒªã‚¹ã‚¯ |
|---|----------|---------------|--------|
| 1 | curl_close() is deprecated | 3 | âš ï¸ |
| 2 | __sleep() soft-deprecated | 1 | âš ï¸ |

## 1. curl_close() is deprecated
**æ¨å¥¨å¯¾å¿œ**: Remove the call or let the handle be garbage collected

### è©²å½“ç®‡æ‰€
#### `src/Http/Client.php`
**Line 42**:
```php
    $result = curl_exec($ch);
>>> curl_close($ch);  // â† è©²å½“è¡Œ
    return $result;
```
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
mw-auto-updater/
â”œâ”€â”€ pyproject.toml         # uv/Python ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”œâ”€â”€ config.toml            # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢è¨­å®š
â”œâ”€â”€ mw_upgrade_check.py    # Phase 1: å¤‰æ›´ç‚¹ãƒã‚§ãƒƒã‚«ãƒ¼
â”œâ”€â”€ analyze_impact.py      # Phase 2: å½±éŸ¿åˆ†æãƒ„ãƒ¼ãƒ«
â”œâ”€â”€ php-upgrade-check.sh   # ã‚·ã‚§ãƒ«ç‰ˆ (ãƒ¬ã‚¬ã‚·ãƒ¼)
â””â”€â”€ data/
    â”œâ”€â”€ php-8.3-changes.toml
    â”œâ”€â”€ php-8.4-changes.toml
    â””â”€â”€ php-8.5-changes.toml
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT
